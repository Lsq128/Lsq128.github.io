<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="baidu-site-verification" content="code-DMcH9tdti5" />
  <meta name="referrer" content="no-referrer" />
  
  <title>æ¢ç©¶Â· è™šæ‹Ÿ(Virtual) Dom Diff | Q Code | é‡äº‹ä¸å†³ å¯é—®æ˜¥é£ æ˜¥é£ä¸è¯­ éµå¾ªè‡ªå¿ƒ</title>

  
  <meta name="author" content="Luis">
  

  
  <meta name="description" content="javaScript">
  

  
  <meta name="keywords" content="å‰ç«¯,åšå®¢,åˆ˜èƒœç¾¤">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="æ¢ç©¶Â· è™šæ‹Ÿ(Virtual) Dom Diff"/>

  <meta property="og:site_name" content="Q Code"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Q Code" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 4.2.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Q Code</a>
    </h1>
    <p class="site-description">é‡äº‹ä¸å†³ å¯é—®æ˜¥é£ æ˜¥é£ä¸è¯­ éµå¾ªè‡ªå¿ƒ</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">ä¸»é¡µ</a></li>
      
        <li><a href="/archives">å½’æ¡£</a></li>
      
        <li><a href="/tags">æ ‡ç­¾</a></li>
      
        <li><a href="/about">å…³äº</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>æ¢ç©¶Â· è™šæ‹Ÿ(Virtual) Dom Diff</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/10/28/æ¢ç©¶Â·-è™šæ‹Ÿ-Virtual-Dom-Diff/" rel="bookmark">
        <time class="entry-date published" datetime="2021-10-27T17:03:58.000Z">
          2021-10-28
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>ä»€ä¹ˆæ˜¯è™šæ‹ŸDom, ä»€ä¹ˆæ˜¯dom diff?</p>
<a id="more"></a>
<h2 id="ä»€ä¹ˆæ˜¯è™šæ‹Ÿ-Virtual-Dom"><a href="#ä»€ä¹ˆæ˜¯è™šæ‹Ÿ-Virtual-Dom" class="headerlink" title="ä»€ä¹ˆæ˜¯è™šæ‹Ÿ(Virtual)Dom"></a>ä»€ä¹ˆæ˜¯è™šæ‹Ÿ(Virtual)Dom</h2><p>è™šæ‹Ÿdomå…¶å®å°±æ˜¯JavaScriptå¯¹è±¡å°†çœŸå®DomæŠ½è±¡ï¼Œå¯¹è±¡å±æ€§æè¿°èŠ‚ç‚¹ä¿¡æ¯ï¼Œè¿™ä¸ªJavaScriptå¯¹è±¡æè¿°äº†Domæ ‘çš„ç»“æ„ï¼Œå½“ç„¶å¹¶ä¸æ˜¯çœŸå®çš„Domæ ‘ï¼Œæ‰€ä»¥ç§°ä¸ºè™šæ‹ŸDomã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°</p>
<p>çœŸå®Dom</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    é˜³å…‰æ­£å¥½ï¼Œå¾®é£ä¸ç‡¥</span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">  	å»è§ä½ æƒ³è§çš„äººå§</span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è™šæ‹ŸDom</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Vnode = &#123;</span><br><span class="line">  sel: <span class="string">"div"</span>,</span><br><span class="line">  props: &#123;<span class="attr">class</span>: <span class="string">"container"</span>&#125;,</span><br><span class="line">  children: [</span><br><span class="line">    &#123;</span><br><span class="line">      sel: <span class="string">"h1"</span>,</span><br><span class="line">      props: &#123;&#125;,</span><br><span class="line">      children: <span class="string">"hello"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      sel: <span class="string">"p"</span>,</span><br><span class="line">      props: &#123;&#125;,</span><br><span class="line">      children: <span class="string">"é˜³å…‰æ­£å¥½ï¼Œå¾®é£ä¸ç‡¥"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      sel: <span class="string">"p"</span>,</span><br><span class="line">      props: &#123;&#125;,</span><br><span class="line">      children: <span class="string">"å»è§ä½ æƒ³è§çš„äººå§"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="è™šæ‹Ÿ-Virtual-Dom-Diff"><a href="#è™šæ‹Ÿ-Virtual-Dom-Diff" class="headerlink" title="è™šæ‹Ÿ(Virtual) Dom Diff"></a>è™šæ‹Ÿ(Virtual) Dom Diff</h2><p>å½“è™šæ‹Ÿdomä¸­çš„æŸä¸ªæˆ–æŸäº›èŠ‚ç‚¹æ”¹å˜ï¼Œä¼šäº§ç”Ÿæ–°çš„è™šæ‹Ÿdom, æ–°ã€æ—§ä¸¤ä¸ªè™šæ‹Ÿdomæ ‘ä¸­å·®å¼‚åŒ–çš„æœ€ä¼˜è§£æ˜ å°„åˆ°çœŸå®domï¼Œå³ä¸ºè™šæ‹ŸDom Diff.</p>
<p>newVnode</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">newVnode = &#123;</span><br><span class="line">  sel: <span class="string">"div"</span>,</span><br><span class="line">  props: &#123;<span class="attr">class</span>: <span class="string">"container"</span>&#125;,</span><br><span class="line">  children: [</span><br><span class="line">    &#123;</span><br><span class="line">      sel: <span class="string">"h1"</span>,</span><br><span class="line">      props: &#123;&#125;,</span><br><span class="line">      children: <span class="string">"hi"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      sel: <span class="string">"p"</span>,</span><br><span class="line">      props: &#123;&#125;,</span><br><span class="line">      children: <span class="string">"é˜³å…‰æ­£å¥½ï¼Œå¾®é£ä¸ç‡¥"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      sel: <span class="string">"p"</span>,</span><br><span class="line">      props: &#123;&#125;,</span><br><span class="line">      children: <span class="string">"å»è§ä½ æƒ³è§çš„äººå§"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚å›¾è§£ï¼š</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gvucpvpz7sj313e0u0di1.jpg" alt="image-20211027214535063" style="zoom:50%;" />

<h2 id="å¦‚ä½•ä½¿ç”¨è™šæ‹ŸdomåŠå­¦ä¹ å…¶diffåŸç†"><a href="#å¦‚ä½•ä½¿ç”¨è™šæ‹ŸdomåŠå­¦ä¹ å…¶diffåŸç†" class="headerlink" title="å¦‚ä½•ä½¿ç”¨è™šæ‹ŸdomåŠå­¦ä¹ å…¶diffåŸç†"></a>å¦‚ä½•ä½¿ç”¨è™šæ‹ŸdomåŠå­¦ä¹ å…¶diffåŸç†</h2><p>è¿™é‡Œå€ŸåŠ©ç°æœ‰çš„è™šæ‹Ÿdomåº“æ¥ä½¿ç”¨ã€äº†è§£ã€åŠå­¦ä¹ ã€‚</p>
<p>è¿™æ¬¡é€‰æ‹©çš„æ˜¯vue2.xä½¿ç”¨çš„è™šæ‹Ÿdomåº“â€”â€”<a href="https://github.com/snabbdom/snabbdom" target="_blank" rel="noopener">snabbdom.js</a></p>
<p><strong>æ ¸å¿ƒä»£ç </strong></p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gvucqu9j6vj30f4052mx6.jpg" alt="image-20211027220246134" style="zoom:80%;" />





<h3 id="Diff-ç®—æ³•åŸç†"><a href="#Diff-ç®—æ³•åŸç†" class="headerlink" title="Diff  ç®—æ³•åŸç†"></a>Diff  ç®—æ³•åŸç†</h3><p>æ–°æ—§è™šæ‹Ÿdomåªä¼šåœ¨åŒå±‚çº§ä¹‹é—´è¿›è¡Œæ¯”è¾ƒï¼Œä¸ä¼šè·¨å±‚çº§è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ca3d338e5a445ab80e40042c50ac79a~tplv-k3u1fbpfcp-watermark.awebp" alt="æˆªå±2021-08-08 ä¸Šåˆ11.32.47.png"></p>
<h3 id="Diff-å¯¹æ¯”æµç¨‹"><a href="#Diff-å¯¹æ¯”æµç¨‹" class="headerlink" title="Diff å¯¹æ¯”æµç¨‹"></a>Diff å¯¹æ¯”æµç¨‹</h3><p>å½“æ•°æ®æ”¹å˜ï¼Œäº§ç”Ÿæ–°çš„è™šæ‹Ÿdom(newVnode),æ­¤æ—¶è°ƒç”¨<code>pathch</code>æ–¹æ³•ï¼Œå°†æ–°æ—§è™šæ‹Ÿdomè¿›è¡Œdiff, å°†ç»“æœæ˜ å°„åˆ°çœŸå®domä¸Šï¼Œè¿›è€Œæ›´æ–°è§†å›¾ã€‚</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gvucrtf9yyj312l0u0gnq.jpg" alt="image-20211027224354551" style="zoom:50%;" />



<h3 id="å…·ä½“åˆ†æ"><a href="#å…·ä½“åˆ†æ" class="headerlink" title="å…·ä½“åˆ†æ"></a>å…·ä½“åˆ†æ</h3><p>è¿™æ˜¯å­¦ä¹ snabbdom.jsæºç åï¼Œè‡ªå·±å®ç°ç®€åŒ–ç‰ˆçš„è™šæ‹Ÿdom, <a href="https://gitee.com/lsq128/study_snabbdom" target="_blank" rel="noopener">é“¾æ¥</a>ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥äº†è§£ä¸€ä¸‹.</p>
<h4 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h4><p>patchæ˜¯diffçš„å…¥å£ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯åˆ¤æ–­æ–°æ—§è™šæ‹Ÿdomæ˜¯å¦ä¸ºåŒä¸€èŠ‚ç‚¹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">oldVnode, newVnode</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­oldVnodeæ˜¯domèŠ‚ç‚¹è¿˜æ˜¯vnode, å¦‚æœæ˜¯domèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¦åŒ…è£…ä¸ºvnode</span></span><br><span class="line">  <span class="keyword">if</span> (!oldVnode.sel) &#123;</span><br><span class="line">    oldVnode = vnode(</span><br><span class="line">      oldVnode.tagName.toLowerCase(),</span><br><span class="line">      &#123;&#125;,</span><br><span class="line">      [],</span><br><span class="line">      <span class="literal">undefined</span>,</span><br><span class="line">      oldVnode</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­oldVnode å’ŒnewVnode æ˜¯å¦ä¸ºåŒä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (oldVnode.key === newVnode.key &amp;&amp; oldVnode.sel === newVnode.sel) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'patch-æ–°æ—§èŠ‚ç‚¹ä¸ºåŒä¸€èŠ‚ç‚¹ï¼Œè¿›è¡ŒpathVnode,è¿›ä¸€æ­¥æ¯”è¾ƒ'</span>);</span><br><span class="line">    patchVnode(oldVnode, newVnode);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'patch-æ–°æ—§èŠ‚ç‚¹ä¸ç›¸åŒï¼Œåˆ™ç›´æ¥å°†æ–°èŠ‚ç‚¹æ›¿æ¢æ—§èŠ‚ç‚¹'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      æ­¤æ—¶å…ˆå°†Vnodeè½¬åŒ–ä¸ºçœŸå®Dom</span></span><br><span class="line"><span class="comment">      å†å°†newDomæ›¿æ¢oldDom</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">const</span> newDomNode = createElement(newVnode);</span><br><span class="line">    <span class="keyword">if</span> (newDomNode &amp;&amp; oldVnode.elm) &#123;</span><br><span class="line">      <span class="comment">// æ’å…¥æ–°èŠ‚ç‚¹</span></span><br><span class="line">      oldVnode.elm.parentNode.insertBefore(newDomNode, oldVnode.elm);</span><br><span class="line">      <span class="comment">// åˆ é™¤æ—§èŠ‚ç‚¹</span></span><br><span class="line">      oldVnode.elm.parentNode.removeChild(oldVnode.elm);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="patchVnode"><a href="#patchVnode" class="headerlink" title="patchVnode"></a>patchVnode</h4><p>patchVnodeä¸»è¦ä½œç”¨æ˜¯åˆ¤æ–­æ–°æ—§è™šæ‹Ÿdomå­é›†çš„æƒ…å†µ.æ ¹æ®ä¸åŒçš„æƒ…å†µ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­Vnode çš„childrenæ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">const</span> checkChildrenEmpty = <span class="function">(<span class="params">Vnode</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> !<span class="built_in">Array</span>.isArray(Vnode.children) || Vnode.children.length === <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">patchVnode</span>(<span class="params">oldVnode, newVnode</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åˆ¤æ–­newVnodeæ˜¯text or children</span></span><br><span class="line"><span class="comment">   *  newVnodeæ˜¯textèŠ‚ç‚¹ï¼Œéœ€è¦å°†oldDomä¸­å­å…ƒç´ æ¸…ç©ºï¼Œæ·»åŠ æ–‡æœ¬å†…å®¹ä¸ºnewVnode.text</span></span><br><span class="line"><span class="comment">   *  newVnodeæ˜¯å«childrenèŠ‚ç‚¹ï¼Œåˆ™éœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­oldVnodeæ˜¯å¦è¿˜æœ‰childrenå­èŠ‚ç‚¹ï¼Ÿ</span></span><br><span class="line"><span class="comment">   *    oldVnodeä¸å«children,åˆ™å°†æ–‡æœ¬å†…å®¹æ¸…ç©ºï¼Œå°†newVnodeä¸­childrenè½¬ä¸ºçœŸå®Domæ’å…¥åˆ°oldDomä¸­</span></span><br><span class="line"><span class="comment">   *    oldVnodeä¹Ÿæ˜¯å«æœ‰childrenå†…å®¹ï¼Œåˆ™éœ€è¦è¿›ä¸€æ­¥ç²¾ç»†åŒ–å¯¹æ¯”ï¼Œæœ€ä¼˜é›…diff</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">if</span> (newVnode.text) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!checkChildrenEmpty(oldVnode)) &#123;</span><br><span class="line">      oldVnode.elm.innerHtml = <span class="string">""</span>;</span><br><span class="line">      oldVnode.elm.innerText = newVnode.text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (newVnode.text !== oldVnode.text) &#123;</span><br><span class="line">      oldVnode.elm.innerText = newVnode.text;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (checkChildrenEmpty(oldVnode)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; newVnode.children.length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> ch = createElement(newVnode.children[i]);</span><br><span class="line">        oldVnode.elm.appendChild(ch);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      updateChildren(oldVnode.elm, oldVnode.children, newVnode.children);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="updateChildren"><a href="#updateChildren" class="headerlink" title="updateChildren"></a>updateChildren</h4><p><code>updateChildren</code>æ˜¯<code>patchVnode</code>ä¸­æœ€å¤æ‚ï¼Œæœ€é‡è¦çš„ä¸€ä¸ªç¯èŠ‚ï¼Œæ–°æ—§è™šæ‹Ÿdomå­èŠ‚ç‚¹çš„æ¯”è¾ƒå°±å‘ç”Ÿåœ¨è¿™é‡Œã€‚</p>
<p><strong>å¯¹æ¯”æ–¹å¼ï¼š</strong></p>
<p>æ–°æ—§è™šæ‹Ÿdomï¼Œæ¯ç»„ <code>é¦–å°¾</code> ä¸¤ä¸ªæŒ‡é’ˆ(start, end)ï¼ŒæŒ‰ç…§5ä¸­ä¸åŒçš„æƒ…å†µä¾æ¬¡æ¯”è¾ƒï¼Œé€šè¿‡æŒ‡é’ˆçš„ç§»åŠ¨ï¼ŒèŠ‚ç‚¹çš„æ¯”è¾ƒï¼Œè¿›è€Œæ›´æ–°è§†å›¾.</p>
<p>ğŸŒ°</p>
<p>æ¨¡ç‰ˆ</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">-</span> <span class="attr">oldVnode</span> <span class="attr">-</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>a<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>b<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>c<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">-</span> <span class="attr">newVnode</span> <span class="attr">-</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>d<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>c<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>b<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>e<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>é¦–å°¾åŒæŒ‡é’ˆ</code>åœ¨è™šæ‹Ÿdomçš„ä½“ç°</p>
<img src="http://tva1.sinaimg.cn/large/008i3skNly1gvucs9nzdlj325o0skmze.jpg" style="zoom:50%;" />



<hr>
<p>ç®—æ³•è¦†ç›–æƒ…å†µå¦‚ä¸‹ï¼š</p>
<p>1.oldStart å’Œ newStartï¼Œå¦‚æœsameVnodeä¸º<code>true</code>,è¿›ä¸€æ­¥<code>patchVnode</code>,ç§»åŠ¨æŒ‡é’ˆ</p>
<p>2.oldEnd å’Œ newEndï¼Œå¦‚æœsameVnodeä¸º<code>true</code>,è¿›ä¸€æ­¥<code>patchVnode</code>,ç§»åŠ¨æŒ‡é’ˆ</p>
<p>3.oldStart å’Œ newEndï¼Œå¦‚æœsameVnodeä¸º<code>true</code>,è¿›ä¸€æ­¥<code>patchVnode</code>,ç§»åŠ¨æŒ‡é’ˆ</p>
<p>4.oldEnd å’Œ newStartï¼Œå¦‚æœsameVnodeä¸º<code>true</code>,è¿›ä¸€æ­¥<code>patchVnode</code>,ç§»åŠ¨æŒ‡é’ˆ</p>
<p>5.ä»¥ä¸Š4ç§è‹¥éƒ½ä¸åŒ¹é…ï¼Œåˆ™æŠŠæ‰€æœ‰å‰©ä½™æ—§å­èŠ‚ç‚¹æŒ‰ç…§keyåšäº†ä¸€ä¸ªMapè¡¨ï¼Œç„¶åç”¨æ–°vnodeçš„keyå»æŸ¥æ‰¾æ˜¯å¦æœ‰å¯å¤ç”¨çš„ä½ç½®.</p>
<p>6.å¦‚æœæ–°æ—§è™šæ‹ŸdomæŸä¸€ç»„å…ˆç§»åŠ¨å®Œæˆ(start &gt; end), åˆ™éœ€è¦å®‰æƒ…å†µæ’å…¥æˆ–åˆ é™¤æŒ‡å®šèŠ‚ç‚¹</p>
<p>æŒ‰ç…§ä¸Šè¿°ç¤ºä¾‹ï¼Œå›¾è§£</p>
<p>1.ç¬¦åˆç¬¬5ç§æƒ…å†µ,æ­¤æ—¶è¦å°†æ–°Vnodeä¸­çš„startVnodeï¼Œæ’å…¥æ—§Vnodeä¸­startVnodeçš„å‰é¢ã€‚æ³¨æ„ï¼šæ­¤æ“ä½œæ˜¯çœŸå®domæ›´æ–°</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gvuctauisbj30x80cwdgh.jpg" style="zoom:50%;" />



<p>æ­¤æ—¶çœŸå®domå’ŒæŒ‡é’ˆç§»åŠ¨æƒ…å†µ</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gvuctnql0cj314m0f8q3u.jpg" style="zoom:50%;" />

<p>2.ç¬¦åˆæ¡ä»¶4ï¼Œæ­¤æ—¶è¦æ“ä½œçœŸå®dom,å°†oldEndVnodeå¯¹åº”çš„èŠ‚ç‚¹æ’åœ¨oldStartVnodeå¯¹åº”çš„èŠ‚ç‚¹å‰ã€‚</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gvucu2d4iqj30t60bg3z3.jpg" style="zoom:50%;" />



<p>æ­¤æ—¶çœŸå®Domå’ŒæŒ‡é’ˆç§»åŠ¨æƒ…å†µ</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gvucufiti0j314c0fkgmj.jpg" style="zoom:50%;" />



<p>3.åŒæ­¥éª¤2ï¼Œä¾æ—§ç¬¦åˆæ¡ä»¶4.</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gvucv32ujlj30uq0bsmxs.jpg" style="zoom:50%;" />

<p>æ­¤æ—¶çœŸå®Domæƒ…å†µå’ŒæŒ‡é’ˆç§»åŠ¨æƒ…å†µå¦‚ä¸‹</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gvucwj9d6wj313u0ee0th.jpg" style="zoom:50%;" />

<p>4.æ­¤æ—¶æƒ…å†µåŒä¸Šè¿°æ­¥éª¤1ï¼Œç¬¦åˆæ¡ä»¶5.</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gvucwyl11aj30rw0auwey.jpg" style="zoom:50%;" />



<p>æ­¤æ—¶çœŸå®Domæƒ…å†µå’ŒæŒ‡é’ˆç§»åŠ¨æƒ…å†µ</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gvucxbvd8vj316u0emmy3.jpg" style="zoom:50%;" />



<p>5.æ­¤æ—¶newStart &gt; newEnd, è¡¨ç¤ºnewVnodeéå†å®Œæˆï¼ŒoldVnode å‰©ä½™èŠ‚ç‚¹éœ€è¦ç§»é™¤.</p>
<p>æœ€ç»ˆæ•ˆæœ:</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNly1gvucxnsvuij30sg04wwei.jpg" style="zoom:50%;" />





<p>updateChildrenæºç å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Element&#125;</span> </span>parentElm çˆ¶èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>oldCh æ—§VnodeèŠ‚ç‚¹ä¸­çš„children</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>newCh æ–°vnodeä¸­çš„children</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">updateChildren</span>(<span class="params">parentElm, oldCh, newCh</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 5ç§æ¯”è¾ƒæƒ…å†µ:</span></span><br><span class="line"><span class="comment">   * 1.oldStrat å’Œ newStrat æ¯”è¾ƒ</span></span><br><span class="line"><span class="comment">   * 2.oldEnd å’Œ newEnd æ¯”è¾ƒ</span></span><br><span class="line"><span class="comment">   * 3.oldStart å’Œ newEnd æ¯”è¾ƒ</span></span><br><span class="line"><span class="comment">   * 4.oldEnd å’Œ newStart æ¯”è¾ƒ</span></span><br><span class="line"><span class="comment">   * 5. å¦‚æœä»¥ä¸Šé€»è¾‘éƒ½åŒ¹é…ä¸åˆ°ï¼Œå†æŠŠæ‰€æœ‰æ—§å­èŠ‚ç‚¹çš„ key åšä¸€ä¸ªæ˜ å°„åˆ°æ—§èŠ‚ç‚¹ä¸‹æ ‡çš„ key -&gt; index è¡¨ï¼Œ</span></span><br><span class="line"><span class="comment">   *    ç„¶åç”¨æ–° vnode çš„ key å»æ‰¾å‡ºåœ¨æ—§èŠ‚ç‚¹ä¸­å¯ä»¥å¤ç”¨çš„ä½ç½®</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¯ä¸ªé›†åˆä¸¤ä¸ªæŒ‡é’ˆ(é¦–å°¾)</span></span><br><span class="line">  <span class="keyword">let</span> oldStartIdx = <span class="number">0</span>,</span><br><span class="line">    oldEndIdx = oldCh.length - <span class="number">1</span>,</span><br><span class="line">    newStartIdx = <span class="number">0</span>,</span><br><span class="line">    newEndIdx = newCh.length - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> oldStartVnode = oldCh[<span class="number">0</span>], </span><br><span class="line">    oldEndVnode = oldCh[oldEndIdx],</span><br><span class="line">    newStartVnode = newCh[<span class="number">0</span>],</span><br><span class="line">    newEndVnode = newCh[newEndIdx];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> oldKeyToIdx <span class="comment">// æ—§Vnodeä¸­key Mapè¡¨</span></span><br><span class="line">  <span class="keyword">let</span> idxInOld <span class="comment">// æ—§Vnodeä¸­æ˜¯å¦å­˜åœ¨æ–°Vnodeçš„æŒ‡å®šVnode</span></span><br><span class="line">  <span class="keyword">let</span> elmToMove <span class="comment">// keyMapè¡¨ä¸­å­˜åœ¨æ–°vnode.keyå¯¹åº”çš„vnode, åˆ™éœ€è¦ç§»åŠ¨</span></span><br><span class="line">  <span class="comment">// å¼€å§‹éå†</span></span><br><span class="line">  <span class="keyword">while</span> (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123;</span><br><span class="line">    <span class="comment">// é¦–å…ˆä¸æ˜¯åˆ¤æ–­å‘½ä¸­ï¼Œè€Œæ˜¯è¦è¿‡æ»¤å·²ç»åŠ undefinedæ ‡è®°çš„ä¸œè¥¿</span></span><br><span class="line">    <span class="keyword">if</span> (oldStartVnode === <span class="literal">null</span> || oldCh[oldStartIdx] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (oldEndVnode === <span class="literal">null</span> || oldCh[oldEndIdx] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (newStartVnode === <span class="literal">null</span> || newCh[newStartIdx] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (newEndVnode === <span class="literal">null</span> || newCh[newEndIdx] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      newEndVnode = newCh[--newEndIdx]</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (checkSameVnode(oldStartVnode, newStartVnode)) &#123;</span><br><span class="line">      <span class="comment">// æ—§å‰-æ–°å‰</span></span><br><span class="line">      patchVnode(oldStartVnode, newStartVnode);</span><br><span class="line">      <span class="comment">// æŒ‡é’ˆç§»åŠ¨</span></span><br><span class="line">      <span class="comment">// å¯¹åº”ä½ç½®Vnode ç§»åŠ¨</span></span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx];</span><br><span class="line">      newStartVnode = newCh[++newStartIdx];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (checkSameVnode(oldEndVnode, newEndVnode)) &#123;</span><br><span class="line">      <span class="comment">// æ—§å-æ–°å</span></span><br><span class="line">      patchVnode(oldEndVnode, newEndVnode);</span><br><span class="line">      <span class="comment">// æŒ‡é’ˆç§»åŠ¨</span></span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx];</span><br><span class="line">      newEndVnode = newCh[--newEndIdx];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (checkSameVnode(oldStartVnode, newEndVnode)) &#123;</span><br><span class="line">      <span class="comment">// æ—§å‰-æ–°å</span></span><br><span class="line">      patchVnode(oldStartVnode, newEndVnode);</span><br><span class="line">      <span class="comment">// å°†çœŸå®domä¸­ï¼Œæ—§å‰domç§»åŠ¨åˆ°å½“å‰æ—§ådomåé¢</span></span><br><span class="line">      parentElm.insertBefore(oldStartVnode.elm, oldEndVnode.elm.nextSibling);</span><br><span class="line">      <span class="comment">// æŒ‡é’ˆç§»åŠ¨</span></span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx];</span><br><span class="line">      newEndVnode = newCh[--newEndIdx];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (checkSameVnode(oldEndVnode, newStartVnode)) &#123;</span><br><span class="line">      <span class="comment">// æ—§å-æ–°å‰</span></span><br><span class="line">      patchVnode(oldEndVnode, newStartVnode);</span><br><span class="line">      parentElm.insertBefore(oldEndVnode.elm, oldStartVnode.elm);</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx];</span><br><span class="line">      newStartVnode = newCh[++newStartIdx];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å‰4ç§æœªå‘½ä¸­ï¼Œåˆ™èµ°æ­¤é€»è¾‘</span></span><br><span class="line">      <span class="keyword">if</span> (oldKeyToIdx === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx) <span class="comment">// æœ‰keyç”Ÿæˆindexè¡¨</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­æ—§-å‰©ä½™èŠ‚ç‚¹ä¸­æ˜¯å¦å­˜åœ¨æ–°å‰èŠ‚ç‚¹</span></span><br><span class="line">      idxInOld = oldKeyToIdx[newStartVnode.key];</span><br><span class="line">      <span class="keyword">if</span> (!idxInOld) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åœ¨æ—§-å‰èŠ‚ç‚¹å‰æ’å…¥è¯¥èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">const</span> dom = createElement(newStartVnode);</span><br><span class="line">        parentElm.insertBefore(dom, oldStartVnode.elm);</span><br><span class="line">        <span class="comment">// æ–°-å‰æŒ‡é’ˆç§»åŠ¨</span></span><br><span class="line">        newStartVnode = newCh[++newStartIdx];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        elmToMove = oldCh[idxInOld];</span><br><span class="line">        <span class="comment">// å¦‚æœé€‰æ‹©å™¨ä¸ä¸€æ ·ï¼Œåˆ™ç›´æ¥æ’å…¥</span></span><br><span class="line">        <span class="keyword">if</span> (elmToMove.sel !== newStartVnode.sel) &#123;</span><br><span class="line">          <span class="keyword">const</span> dom = createElement(newStartVnode);</span><br><span class="line">          parentElm.insertBefore(dom, oldStartVnode.elm);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// å¦‚æœé€‰æ‹©å™¨ä¹Ÿä¸€æ ·ï¼Œåˆ™è¿›è¡ŒpatchVnode</span></span><br><span class="line">          patchVnode(elmToMove, newStartVnode);</span><br><span class="line">          oldCh[idxInOld] = <span class="literal">null</span>;</span><br><span class="line">          parentElm.insertBefore(elmToMove.elm, oldStartVnode.elm);</span><br><span class="line">        &#125;</span><br><span class="line">        newStartVnode = newCh[++newStartIdx];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (oldStartIdx &gt; oldEndIdx) &#123;</span><br><span class="line">    <span class="comment">// æ­¤æ—¶è¡¨ç¤ºoldVnode listå·²ç»éå†ç»“æŸï¼ŒnewVnodeList å‰©ä½™Vnode éœ€è¦è½¬æ¢æˆçœŸå®Domæ’å…¥</span></span><br><span class="line">    <span class="keyword">let</span> base = oldEndVnode.elm;</span><br><span class="line">    <span class="keyword">for</span> (; newStartIdx &lt;= newEndIdx; ++newStartIdx) &#123;</span><br><span class="line">      parentElm.insertBefore(createElement(newCh[newStartIdx]), base.nextSibling);</span><br><span class="line">      base = base.nextSibling;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (newStartIdx &gt; newEndIdx) &#123;</span><br><span class="line">    <span class="comment">// æ­¤æ—¶è¡¨ç¤ºnewVnode list å·²ç»éå†ç»“æŸï¼Œ oldVnodeList å‰©ä½™ndoe éœ€è¦ç§»é™¤</span></span><br><span class="line">    <span class="keyword">for</span> (;oldStartIdx &lt;= oldEndIdx; ++oldStartIdx) &#123;</span><br><span class="line">      oldCh[oldStartIdx] &amp;&amp; parentElm.removeChild(oldCh[oldStartIdx].elm);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><ol>
<li><a href="https://github.com/snabbdom/snabbdom" target="_blank" rel="noopener">snabbdomæºç ä¸‹è½½</a></li>
<li><a href="https://juejin.cn/post/6844903607913938951#heading-3" target="_blank" rel="noopener">https://juejin.cn/post/6844903607913938951#heading-3</a></li>
<li><a href="https://juejin.cn/post/6994959998283907102" target="_blank" rel="noopener">https://juejin.cn/post/6994959998283907102</a></li>
</ol>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>

  






    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2022 Luis
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>